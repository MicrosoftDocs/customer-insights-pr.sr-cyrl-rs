---
title: Повежите се Common Data Model фасциклом која користи Azure Data Lake налог
description: Радите са Common Data Model подацима користећи Azure Data Lake Storage.
ms.date: 09/29/2022
ms.topic: how-to
author: mukeshpo
ms.author: mukeshpo
ms.reviewer: v-wendysmith
manager: shellyha
searchScope:
- ci-data-sources
- ci-create-data-source
- ci-attach-cdm
- customerInsights
ms.openlocfilehash: c12603b9ed8a814356a0f8d0137e97afc749b87c
ms.sourcegitcommit: be341cb69329e507f527409ac4636c18742777d2
ms.translationtype: MT
ms.contentlocale: sr-Cyrl-RS
ms.lasthandoff: 09/30/2022
ms.locfileid: "9609966"
---
# <a name="connect-to-data-in-azure-data-lake-storage"></a>Повежите се са подацима у услузи Azure Data Lake Storage

Унестите податке Dynamics 365 Customer Insights у свој Azure Data Lake Storage Gen2 налог. Уношење података може бити пуно или постепено.

## <a name="prerequisites"></a>Предуслови

- Уношење података подржава Azure Data Lake Storage *искључиво Gen2* налоге. Не можете да користите Дата Лаке Стораге Gen1 налоге да бисте унели податке.

- Налог Azure Data Lake Storage мора имати [омогућен хијерархијски простор за име](/azure/storage/blobs/data-lake-storage-namespace). Подаци морају бити ускладиштени у хијерархијски фасцикле који дефинише основну фасциклу и има потфасцикле за сваки ентитет. Потфасцикле могу да имају пуне податке или постепене фасцикле са подацима.

- Да бисте потврдили идентитет помоћу принципала услуге Azure, уверите се да је конфигурисан у вашем закупцу. Више информација потражите у чланку [Повезивање са Azure Data Lake Storage Gen2 налогом помоћу директора Азуре услуге](connect-service-principal.md).

- Подаци Azure Data Lake Storage из којих желите да повежете и из којих уносите податке мора да буде у истој Азуре области као и Dynamics 365 Customer Insights окружење. Не подржавају се везе са Common Data Model фасциклом из језера података у другом Azure региону. Да бисте знали Азурну област окружења, посетите локацију **Админ** > **Сyстем** > **Абоут** ин Цустомер Инсигхтс.

- Подаци ускладиштени у услугама на мрежи могу се ускладиштити на другој локацији од места где се подаци обрађују или складиште у програму Dynamics 365 Customer Insights.Увозом или повезивањем са подацима ускладиштеним у услугама на мрежи слажете се да се подаци могу преносити и складиштити са програмом Dynamics 365 Customer Insights .  [Сазнајте више у Мицрософт центру за поузданост](https://www.microsoft.com/trust-center).

- Главница услуге "Увиди купаца" мора бити у једној од следећих улога да би приступила налогу за складиштење. Више информација потражите у чланку [Додељивање дозвола директору услуге за приступ налогу за складиштење](connect-service-principal.md#grant-permissions-to-the-service-principal-to-access-the-storage-account).
  - Читач података складишта блоб објекта
  - Власник података складишта блоб објекта
  - Сарадник за податке складишта блоб објекта

- Кориснику који подешаје везу извор података потребно најмање дозвола за складиштење блоб сарадник на налогу за складиштење.

- Подаци у складишту језера података треба да прате стандард Цоммон Дата Модел за складиштење података и да имају заједнички манифест модела података који представља шему датотека са подацима (*.цсв или *.паркет). Манифест мора да пружи детаље ентитета као што су колоне ентитета и типови података, као и локацију датотеке са подацима и тип датотеке. Више информација потражите у манифесту [Уобичајени модел података](/common-data-model/sdk/manifest). Ако манифест није присутан, администраторски корисници са власником података "Стораге Блоб" или "Стораге Блоб Дата сарадник" могу да дефинишу шему приликом уноса података.

## <a name="recommendations"></a>Препоруке

За оптималне перформансе, Цустомер Инсигхтс препоручује да величина партиције буде 1 ГБ или мања, а број датотека партиција у фасцикли не сме да премаши 1000.

## <a name="connect-to-azure-data-lake-storage"></a>Повезивање са услугом Azure Data Lake Storage

1. Идите на **Подаци** > **Извори података**.

1. Изаберите **Додај извор података**.

1. Изаберите **Азуре складиште језера са подацима**.

   :::image type="content" source="media/data_sources_ADLS.png" alt-text="Дијалог за унос детаља везе за Азуре Дата Лаке." lightbox="media/data_sources_ADLS.png":::

1. Унесите **име** за извор података и опционални **опис**. Име јединствено идентификује извор података упућује на низводне процесе и не може се мењати.

1. Одаберите једну од следећих опција за повезивање **складишта помоћу**. Више информација потражите у чланку [Повезивање увида клијената са Azure Data Lake Storage Gen2 налогом помоћу Азуре сервисног директора](connect-service-principal.md).

   - **Азуре ресурс:** Унесите **ИД ресурса** . Опционално, ако желите да уносите податке из налога за складиштење путем Азуре приватне везе, изаберите опцију Омогући **приватну везу**. Више информација потражите у чланку [Приватне везе](security-overview.md#set-up-an-azure-private-link).
   - **Азуре претплате** : Изаберите претплату **, а** затим налог **групе ресурса** **и складишта**. Опционално, ако желите да уносите податке из налога за складиштење путем Азуре приватне везе, изаберите опцију Омогући **приватну везу**. Више информација потражите у чланку [Приватне везе](security-overview.md#set-up-an-azure-private-link).
  
   > [!NOTE]
   > Потребна вам је једна од следећих улога контејнера или налога за складиштење да бисте креирали извор података:
   >
   >  - Подаци о складиштењу читалац су довољни за читање са налога за складиштење и унос података у увиде клијената.
   >  - Подаци о складиштењу сарадник или власник су потребни ако желите да уредите манифестне датотеке директно у увидима купаца.  
  
1. Одаберите име контејнера који **садржи податке и шему (модел.јсон или манифест.јсон датотека) из којег желите да увезете податке, а затим кликните на дугме Даље** **.**
   > [!NOTE]
   > Ниједна датотека model.json или manifest.json повезана са другим извором података у окружењу неће се приказати на листи. Међутим, иста датотека model.json или manifest.json може се користити за изворе података у више окружења.

1. Да бисте креирали нову шему, идите на [ставку Креирање нове датотеке шеме](#create-a-new-schema-file).

1. Да бисте користили постојећу шему, дођите до фасцикле која садржи датотеку модел.јсон или манифест.цдм.јсон. Можете да претражујете у каталогу да бисте пронашли датотеку.

1. Изаберите јсон датотеку и кликните на дугме **Даље**. Приказаће се листа доступних ентитета.

   :::image type="content" source="media/review-entities.png" alt-text="Дијалог листе ентитета за избор":::

1. Изаберите ентитете које желите да укључите.

   :::image type="content" source="media/ADLS_required.png" alt-text="Дијалог који приказује потребан за примарни кључ":::

   > [!TIP]
   > Да бисте уредили ентитет у ЈСОН интерфејсу за уређивање, изаберите ентитет, а затим уредите **датотеку шеме**. Извршите промене и изаберите **Сачувај**.

1. За изабране ентитете који захтевају постепено уношење, потребни екрани **у оквиру** постепеног **освежавања**. За сваки од ових ентитета погледајте чланак [Конфигурисање постепеног освежавања за Азуре Дата Лаке изворе података](incremental-refresh-data-sources.md).

1. За изабране ентитете у којима примарни кључ није дефинисан, потребни прикази **у оквиру** примарног **кључа**. За сваки од ових ентитета:
   1. Изаберите **потребну**. Приказује **се табла"Уређивање** ентитета".
   1. Одаберите **примарни кључ**. Примарни кључ је атрибут јединствен за ентитет. Да би атрибут био важећи примарни кључ, не би требало да садржи дуплиране вредности, недостајуће вредности или празне вредности. Атрибути типа ниска, цео број и ГУИД тип података су подржани као примарни кључеви.
   1. Опционално, промените образац партиције.
   1. Кликните на **дугме "** Затвори" да бисте сачували и затворили таблу.

1. Изаберите број атрибута **за** сваки укључени ентитет. Приказаће **се страница"Управљање** атрибутима".

   :::image type="content" source="media/dataprofiling-entities.png" alt-text="Дијалог за избор профилисања података.":::

   1. Креирајте нове атрибуте, уредите или избришите постојеће атрибуте. Можете да промените име, формат података или да додате семантички тип.
   1. Да бисте омогућили аналитику и друге могућности, изаберите **профилисање** података за цео ентитет или за одређене атрибуте. Подразумевано ниједан ентитет није омогућен за профилисање података.
   1. Изаберите **Готово**.

1. Изаберите **Сачувај**. Отвориће **се страница"Извори података" која приказује нову извор података статусу "Освежавање** **·** ".

   [!INCLUDE [progress-details-include](includes/progress-details-pane.md)]

Учитавање података може потрајати. Након успешног освежавања, унети подаци се могу редиговање са странице [**"Ентитети**](entities.md) ".

### <a name="create-a-new-schema-file"></a>Креирање нове датотеке шеме

1. Изаберите **нову датотеку шеме**.

1. Унесите име датотеке и изаберите **сачувај**.

1. Изаберите **нови ентитет**. Приказаће **се табла** "Нови ентитет".

1. Унесите име ентитета и одаберите локацију датотека **са подацима**.
   - **Више .цсв или .паркета** : Потражите основну фасциклу, изаберите тип шаре и унесите израз.
   - **Појединачне.цсв или .паркет** : Потражите датотеку .цсв или .паркета и изаберите је.

   :::image type="content" source="media/ADLS_new_entity_location.png" alt-text="Дијалог за креирање новог ентитета са истакнутом локацијом датотека са подацима.":::

1. Изаберите **Сачувај**.

   :::image type="content" source="media/ADLS_new_entity_define_attributes.png" alt-text="Дијалог за дефинисање или аутоматско генерисање атрибута.":::

1. Потврдите **избор у овом пољу за потврду** дефинишите атрибуте да бисте ручно додали атрибуте или изаберите аутоматско **генерисање**. Да бисте дефинисали атрибуте, унесите име, изаберите формат података и опционални семантички тип. За аутоматски генерисане атрибуте:

   1. Након што се атрибути аутоматски генеришу, изаберите ставку **Редигуј атрибуте**. Приказаће **се страница"Управљање** атрибутима".

   1. Уверите се да је формат података исправан за сваки атрибут.

   1. Да бисте омогућили аналитику и друге могућности, изаберите **профилисање** података за цео ентитет или за одређене атрибуте. Подразумевано ниједан ентитет није омогућен за профилисање података.

      :::image type="content" source="media/dataprofiling-entities.png" alt-text="Дијалог за избор профилисања података.":::

   1. Изаберите **Готово**. Приказаће **се страница"Избор** ентитета".

1. Наставите да додајете ентитете и атрибуте, ако је применљиво.

1. Након што додате све ентитете, изаберите опцију **Укључи** да бисте укључили ентитете у извор података ингестион.

   :::image type="content" source="media/ADLS_required.png" alt-text="Дијалог који приказује потребан за примарни кључ":::

1. За изабране ентитете који захтевају постепено уношење, потребни екрани **у оквиру** постепеног **освежавања**. За сваки од ових ентитета погледајте чланак [Конфигурисање постепеног освежавања за Азуре Дата Лаке изворе података](incremental-refresh-data-sources.md).

1. За изабране ентитете у којима примарни кључ није дефинисан, потребни прикази **у оквиру** примарног **кључа**. За сваки од ових ентитета:
   1. Изаберите **потребну**. Приказује **се табла"Уређивање** ентитета".
   1. Одаберите **примарни кључ**. Примарни кључ је атрибут јединствен за ентитет. Да би атрибут био важећи примарни кључ, не би требало да садржи дуплиране вредности, недостајуће вредности или празне вредности. Атрибути типа ниска, цео број и ГУИД тип података су подржани као примарни кључеви.
   1. Опционално, промените образац партиције.
   1. Кликните на **дугме "** Затвори" да бисте сачували и затворили таблу.

1. Изаберите **Сачувај**. Отвориће **се страница"Извори података" која приказује нову извор података статусу "Освежавање** **·** ".

   [!INCLUDE [progress-details-include](includes/progress-details-pane.md)]

Учитавање података може потрајати. Након успешног освежавања, унети подаци се могу редиговање са странице [**"Ентитети**](entities.md) ".

## <a name="edit-an-azure-data-lake-storage-data-source"></a>Уређивање Azure Data Lake Storage извор података

Помоћу опције можете да *ажурирате налог за повезивање са* складиштем. Више информација потражите у чланку [Повезивање увида клијената са Azure Data Lake Storage Gen2 налогом помоћу Азуре сервисног директора](connect-service-principal.md). Да бисте се повезали на други контејнер са налога за складиштење или да промените име налога, [креирајте нову везу са извором података](#connect-to-azure-data-lake-storage).

1. Идите на **Подаци** > **Извори података**.

1. Поред извор података желите да ажурирате, изаберите ставку **Уреди**.

   :::image type="content" source="media/data_sources_edit_ADLS.png" alt-text="Дијалог за уређивање Азуре Дата Лаке извор података.":::

1. Промените неку од следећих информација:

   - **Опис**
   - **Повежите складиште користећи информације** о вези и вези. Не можете променити информације о **контејнеру** приликом ажурирања везе.
      > [!NOTE]
      > Једна од следећих улога мора бити додељена налогу за складиштење или контејнеру:
        > - Читач података складишта блоб објекта
        > - Власник података складишта блоб објекта
        > - Сарадник за податке складишта блоб објекта

   - **Омогућите приватну** везу ако желите да уносите податке са налога за складиштење путем Азуре приватне везе. Више информација потражите у чланку [Приватне везе](security-overview.md#set-up-an-azure-private-link).

1. Изаберите **Следеће**.
1. Промените нешто од следећег:
   - Крећите се до друге датотеке модел.јсон или манифест.јсон са различитим скупом ентитета из контејнера.
   - Изаберите нови ентитет да бисте додали додатне ентитете **у јело**.
   - Изаберите ентитет и Избриши да бисте уклонили све већ изабране ентитете ако нема **зависности**.
      > [!IMPORTANT]
      > Ако постоје зависности од постојеће датотеке model.json или manifest.json и скупа ентитета, видећете поруку о грешци и не можете да изаберете другу датотеку model.json или manifest.json. Уклоните те зависности пре промене датотеке model.json или manifest.json или креирајте нови извор података са датотеком model.json или manifest.json коју желите да користите да бисте избегли уклањање зависности.
   - Да бисте променили локацију датотеке са подацима или примарни кључ, кликните на дугме " **Уреди"**.
   - Да бисте променили постепене податке о ингесцији, погледајте [чланак Конфигурисање постепеног освежавања за Азуре Дата Лаке изворе података](incremental-refresh-data-sources.md).
   - Промените само име ентитета тако да се подудара са именом ентитета у .јсон датотеци.

     > [!NOTE]
     > Име ентитета увек држите у увидима клијената исто као име ентитета унутар датотеке модел.јсон или манифест.јсон након уношења. Цустомер Инсигхтс проверава ваљаност свих имена ентитета помоћу модела.јсон или манифест.јсон током сваког освежавања система. Ако је име ентитета промењено унутар увида купца или споља, долази до грешке зато што увиди клијената не могу да пронађу ново име ентитета у .јсон датотеци. Ако је име ентитета случајно промењено, уредите име ентитета у фасцикли "Увиди купаца" да би се подударало са именом у .јсон датотеци.

1. Изаберите **атрибуте да** бисте додали или променили атрибуте или да бисте омогућили профилисање података. Затим изаберите **Готово**.

1. Кликните **на дугме** "Сачувај" да бисте применили промене и вратили се на **страницу "Извори података** ".

   [!INCLUDE [progress-details-include](includes/progress-details-pane.md)]

## <a name="common-reasons-for-ingestion-errors-or-corrupt-data"></a>Уобичајени разлози за грешке у брисању или оштећење података

Током уношења података, неки од најчешћих разлога због којих се запис може сматрати оштећеним су:

- Типови података и вредности поља се не подударају између изворне датотеке и шеме
- Број колона у изворној датотеци се не подудара са шемом
- Поља садрже знакове због којих се колоне косе у поређењу са очекиваном шемом. На пример: неправилно обликовани наводници, неискапљени наводници, знакови за нови број или знакови на картицама.
- Недостају датотеке партиција
- Ако постоје колоне датума/датума/датума/датума, њихов формат мора бити наведен у шеми ако не следи стандардни формат.

### <a name="schema-or-data-type-mismatch"></a>Неподударање шеме или типа података

Ако подаци нису у складу са шемом, процес брисања се довршава грешкама. Исправите изворне податке или шему и поново их унесите.

### <a name="partition-files-are-missing"></a>Недостају датотеке партиција

- Ако је ингестион био успешан без оштећених записа, али не можете да видите податке, уредите датотеку модел.јсон или манифест.јсон да бисте се уверили да су партиције наведене. Затим освежите [извор података](data-sources.md#refresh-data-sources).

- Ако дође до уношења података у исто време када се извори података освежавају током аутоматског освежавања распореда, датотеке партиција могу бити празне или нису доступне за обраду увида корисника. Да бисте се поравнали са распоредом освежавања узводно, промените [распоред освежавања](schedule-refresh.md) система или распоред освежавања извор података. Поравнајте временски распоред тако да се освежавања не појављују одједном и обезбеђују најновије податке који ће бити обрађени у увидима клијената.

### <a name="datetime-fields-in-the-wrong-format"></a>Поља датума у погрешном формату

Поља датума у ентитету нису у ИСО 8601 или ен-УС форматима. Подразумевани формат датума у увидима клијената је ен-УС формат. Сва поља датума у ентитету треба да буду у истом формату. Увиди клијената подржавају друге формате наведене белешке или особине које се излаћу на нивоу извора или ентитета у моделу или манифесту.јсон. На пример: 

**Модел.јсон**

   ```json
      "annotations": [
        {
          "name": "ci:CustomTimestampFormat",
          "value": "yyyy-MM-dd'T'HH:mm:ss:SSS"
        },
        {
          "name": "ci:CustomDateFormat",
          "value": "yyyy-MM-dd"
        }
      ]   
   ```

  У манифесту.јсон, формат датума може бити наведен на нивоу ентитета или на нивоу атрибута. На нивоу ентитета користите "особине експоната" у ентитету у *.манифест.цдм.јсон да бисте дефинисали формат датума. На нивоу атрибута користите"примењене особине" у атрибуту у имену ентитета.цдм.јсон.

**Манифест .јсон на нивоу ентитета**

```json
"exhibitsTraits": [
    {
        "traitReference": "is.formatted.dateTime",
        "arguments": [
            {
                "name": "format",
                "value": "yyyy-MM-dd'T'HH:mm:ss"
            }
        ]
    },
    {
        "traitReference": "is.formatted.date",
        "arguments": [
            {
                "name": "format",
                "value": "yyyy-MM-dd"
            }
        ]
    }
]
```

**Ентитет .јсон на нивоу атрибута**

```json
   {
      "name": "PurchasedOn",
      "appliedTraits": [
        {
          "traitReference": "is.formatted.date",
          "arguments" : [
            {
              "name": "format",
              "value": "yyyy-MM-dd"
            }
          ]
        },
        {
          "traitReference": "is.formatted.dateTime",
          "arguments" : [
            {
              "name": "format",
              "value": "yyyy-MM-ddTHH:mm:ss"
            }
          ]
        }
      ],
      "attributeContext": "POSPurchases/attributeContext/POSPurchases/PurchasedOn",
      "dataFormat": "DateTime"
    }
```

[!INCLUDE [footer-include](includes/footer-banner.md)]
