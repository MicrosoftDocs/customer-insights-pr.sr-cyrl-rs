---
title: Надгледање Dynamics 365 Customer Insights помоћу Азуре монитора
description: Сазнајте како да пошаљете евиденције на Microsoft Azure монитор.
ms.date: 12/14/2021
ms.reviewer: mhart
ms.service: customer-insights
ms.subservice: audience-insights
ms.topic: article
author: brndkfr
ms.author: bkief
manager: shellyha
ms.openlocfilehash: d962c359d70a068fcf939b61e340f86de088b419
ms.sourcegitcommit: 0c3c473e0220de9ee3c1f1ee1825de0b3b3663c3
ms.translationtype: HT
ms.contentlocale: sr-Cyrl-RS
ms.lasthandoff: 12/14/2021
ms.locfileid: "7920876"
---
# <a name="log-forwarding-in-dynamics-365-customer-insights-with-azure-monitor-preview"></a>Пријављивање помоћу Dynamics 365 Customer Insights Азуре монитора (преглед)

Dynamics 365 Customer Insights обезбеђује директну интеграцију са Азуре монитором. Евиденције ресурса Азуре монитора вам омогућава да надгледате и [шаљете евиденције у Азуре складиште](https://azure.microsoft.com/services/storage/), [Азуре аналитику евиденције или да](/azure/azure-monitor/logs/log-analytics-overview) их [стримујете у Азуре чворишта догађаја](https://azure.microsoft.com/services/event-hubs/).

Увиди купаца шаљу следеће евиденције догађаја:

- **Догађаји надгледања**
  - **АПИЕвент** - омогућава праћење промена урађено путем Dynamics 365 Customer Insights УИ.
- **Оперативни догађаји**
  - **WorkflowEvent** - Ток посла омогућава особи да подеси [изворе података](data-sources.md), [обједини](data-unification.md) и [обогати](enrichment-hub.md) и коначно [извезе](export-destinations.md) податке у друге системе. Сви ти кораци могу да се ураде појединачно (нпр. да се покрене један извоз) или да се оркестрира (нпр. освежавање података из извора података који покрећу процес уједињења који ће повући додатна богаћења и једном обавити извоз података у други систем). Више детаља потражите у [шеми WоркфлоwЕвент](#workflow-event-schema).
  - **АПИЕвент** - сви АПИ позиви клијентима инстанце да Dynamics 365 Customer Insights. Више детаља потражите у [АПИЕвент шеми](#api-event-schema).

## <a name="set-up-the-diagnostic-settings"></a>Подешавање дијагностичких поставки

### <a name="prerequisites"></a>Предуслови

Да бисте конфигурисали дијагностику у увидима клијената, морају бити испуњени следећи предуслови:

- Имате активну [Азурну претплату](https://azure.microsoft.com/pricing/purchase-options/pay-as-you-go/).
- Имате [администраторске](permissions.md#administrator) дозволе у фасцикли "Увиди клијената".
- Имате улогу **администратора сарадник** и **корисничког** приступа на одредишном ресурсу на Азуре. Ресурс може бити Азуре налог складишта, Азуре чвориште догађаја или радни простор Азуре аналитике евиденције. Више информација потражите у [чланку Додавање или уклањање додела Азуре улога помоћу Азуре портала](/azure/role-based-access-control/role-assignments-portal).
- [Испуњени](/azure/azure-monitor/platform/diagnostic-settings#destination-requirements) су одредишни захтеви за Азуре складиште, Азуре чвориште догађаја или Азуре аналитику евиденције.
- Имате барем улогу **читалац** групи ресурса којој ресурс припада.

### <a name="set-up-diagnostics-with-azure-monitor"></a>Подешавање дијагностике помоћу Азуре монитора

1. У чланку Увиди клијената **изаберите** > **системску** дијагностику да бисте видели одредишта дијагностике конфигурисана за ову инстанцу.

1. Изаберите **додај одредиште**.

   > [!div class="mx-imgBorder"]
   > ![Дијагностичка веза](media/diagnostics-pane.png "Дијагностичка веза")

1. Наведите име у **одредишном пољу Име за** дијагностику.

1. Одаберите **закупца** Азуре претплате са одредишним ресурсом и изаберите **пријављивање**.

1. Изаберите тип **ресурса** (налог складишта, чвориште догађаја или аналитика евиденције).

1. Изаберите **претплату** за одредишни ресурс.

1. Изаберите **групу Ресурс** за одредишни ресурс.

1. Изаберите **ресурс**.

1. Потврдите изјаву **о приватности и усаглашености са** подацима.

1. Изаберите **опцију Повежи се са** системом да бисте се повезали са одредишним ресурсом. Евиденције почињу да се појављују на одредишту после 15 минута, ако је АПИ у употреби и генерише догађаје.

### <a name="remove-a-destination"></a>Уклањање одредишта

1. Идите **на** > **дијагностику система**.

1. Изаберите одредиште дијагностике са листе.

1. У колони **Радње** изаберите икону **"Избриши".**

1. Потврдите брисање да бисте зауставили прослеђивање евиденције. Ресурс на Азуре претплати неће бити избрисан. Можете изабрати везу у **колони** "Радње" да бисте отворили портал Азуре за изабрани ресурс и тамо га избрисали.

## <a name="log-categories-and-event-schemas"></a>Евидентирај категорије и шеме догађаја

Тренутно су [подржани АПИ](apis.md) догађаји и догађаји тока посла и примењују се следеће категорије и шеме.
Шема евиденције прати заједничку [шему Азуре монитора](/azure/azure-monitor/platform/resource-logs-schema#top-level-common-schema).

### <a name="categories"></a>Категорије

Увиди купаца обезбеђују две категорије:

- **Догађаји** надгледања : [АПИ догађаји](#api-event-schema) за праћење промена конфигурације на услузи. `POST|PUT|DELETE|PATCH` операције иду у ову категорију.
- **Оперативни догађаји** : [АПИ догађаји или](#api-event-schema) догађаји [тока посла](#workflow-event-schema) генерисани током коришћења услуге.  На пример, `GET` захтеви или догађаји извршавања тока посла.

## <a name="configuration-on-the-destination-resource"></a>Конфигурација одредишног ресурса

На основу вашег избора на типу ресурса аутоматски ће се применити следећи кораци:

### <a name="storage-account"></a>Налог складишта

Директор услуге "Увиди **купаца" добија дозволу сарадник** за складиштење на изабраном ресурсу и креира два контејнера под изабраним простором за име:

- `insight-logs-audit` који садрже догађаје **надгледања**
- `insight-logs-operational` који садрже **оперативне догађаје**

### <a name="event-hub"></a>Чвориште догађаја

Директор услуге "Цустомер Инсигхтс" **добија дозволу чворишта догађаја Азуре власника** података за ресурс и креираће два чворишта догађаја под изабраним простором за име:

- `insight-logs-audit` који садрже догађаје **надгледања**
- `insight-logs-operational` који садрже **оперативне догађаје**

### <a name="log-analytics"></a>Евидентирај аналитику

Директор услуге"Увид у кориснике" **добија дозволу за сарадник** евиденције о ресурсу. Евиденције ће бити доступне у оквиру **ставке Управљање** > **·** > **евиденцијама табела на** изабраном радном простору аналитике евиденције. Развијте решење **за управљање** евиденцијом и пронађите `CIEventsAudit``CIEventsOperational` табеле и табеле.

- `CIEventsAudit` који садрже догађаје **надгледања**
- `CIEventsOperational` који садрже **оперативне догађаје**

У **прозору** Упити проширите решење **надзора** и пронађите пример упита наведених претраживањем `CIEvents`.

## <a name="event-schemas"></a>Шеме догађаја

АПИ догађаји и догађаји тока посла имају заједничку структуру и детаље у којима се разликују, [погледајте АПИ шему догађаја](#api-event-schema) или [шему догађаја тока посла](#workflow-event-schema).

### <a name="api-event-schema"></a>Шема АПИ догађаја

| Поље             | Типподатака  | Обавезно/опционално | Опис       | Пример        |
| ----------------- | --------- | ----------------- | --------------------- | ------------------------ |
| `time`            | Временска ознака | Потребно          | Тиместамп догађаја (УТЦ)       | `2020-09-08T09:48:14.8050869Z`         |
| `resourceId`      | String    | Потребно          | ИД ресурса инстанце која је емигрирао догађај         | `/SUBSCRIPTIONS/XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXX/RESOURCEGROUPS/<RESOURCEGROUPNAME>/`<br>`PROVIDERS/MICROSOFT.D365CUSTOMERINSIGHTS/`<br>`INSTANCES/XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXX`  |
| `operationName`   | String    | Потребно          | Име операције представљене овим догађајем.                                                                                                                | `Workflows.GetWorkFlowStatusAsync`                                                                                                                                       |
| `category`        | String    | Потребно          | Евидентирај категорију догађаја. Или `Operational``Audit` или. Алл ПОСТ/ПУТ/ПАТЦХ/ДЕЛЕТЕ ХТТП Реqуестс аре таггед wитх `Audit`, све остало са`Operational` | `2020-09-08T09:48:14.8050869Z`                                                                                                                                           |
| `resultType`      | String    | Потребно          | Статус догађаја. `Success`, `ClientError`, `Failure`                                                                                                        |                                                                                                                                                                          |
| `resultSignature` | String    | Опционално          | Статус резултата догађаја. Ако операција одговара РЕСТ АПИ позиву, то је ХТТП статусни кôд.        | `200`             |
| `durationMs`      | Дугачак      | Опционално          | Трајање операције у милисекундама.     | `133`     |
| `callerIpAddress` | String    | Опционално          | ИП адреса позиваоца, ако операција одговара АПИ позиву који долази са јавно доступне ИП адресе.                                                 | `144.318.99.233`         |
| `identity`        | String    | Опционално          | ЈСОН објекат који описује идентитет корисника или апликације која је урадила операцију.       | Погледајте [одељак](#identity-schema) Идентитет.     |  |
| `properties`      | String    | Опционално          | ЈСОН објекат са више својстава према одређеној категорији догађаја.      | Погледајте [одељак](#api-properties-schema) Својства.    |
| `level`           | String    | Потребно          | Ниво озбиљности догађаја.    | `Informational`, `Warning`,, или `Error``Critical`.           |
| `uri`             | String    | Опционално          | Апсолутни захтев УРИ.    |               |

#### <a name="identity-schema"></a>Шема идентитета

ЈСОН `identity` објекат има следећу структуру

```json
{
  "Authorization" : {
    "UserRole": "Admin",
    "RequiredRoles": [
      "Contributor",
      "Viewer"
      ]
    },
  "Claims" {
    "claimNameX" : "claimValueX",
    "claimNameY" : "claimValueY"
   }
}  
```

| Поље                         | Опис                                                                                                                          |
| ----------------------------- | ------------------------------------------------------------------------------------------------------------------------------------ |
| `Authorization.UserRole`      | Додељена улога за корисника или апликацију. Више информација потражите у [чланку Корисничке дозволе](permissions.md).                                     |
| `Authorization.RequiredRoles` | Потребне улоге за операцију. `Admin` улога је дозвољена за све операције.                                                    |
| `Claims`                      | Тврдње корисника или апликације ЈСОН Wеб токен (ЈWТ). Својства захтева се разликују по организацији и Azure Active Directory конфигурацији. |

#### <a name="api-properties-schema"></a>Шема АПИ својстава

[АПИ догађаји](apis.md) имају следећа својства.

| Поље                        | Опис                                                                                                            |
| ---------------------------- | ---------------------------------------------------------------------------------------------------------------------- |
| `properties.eventType`       | Увек `ApiEvent`, означавање догађаја евиденције као АПИ догађаја.                                                                 |
| `properties.userAgent`       | Агент прегледача шаље захтев или `unknown`.                                                                        |
| `properties.method`          | ХТТП метод:`GET/POST/PUT/PATCH/HEAD`.                                                                                |
| `properties.path`            | Релативна путања захтева.                                                                                          |
| `properties.origin`          | УРИ који показује одакле долази допремање или `unknown`.                                                                  |
| `properties.operationStatus` | `Success` за ХТТП статусни кôд &лт; 400 <br> `ClientError` за ХТТП статусни кôд &лт; 500 <br> `Error` за ХТТП Статус &гт;= 500 |
| `properties.tenantId`        | ID организације                                                                                                        |
| `properties.tenantName`      | Име организације.                                                                                              |
| `properties.callerObjectId`  | Azure Active Directory ИД објекта позиваоца.                                                                         |
| `properties.instanceId`      | Увиди купаца`instanceId`                                                                                         |

### <a name="workflow-event-schema"></a>Шема догађаја тока посла

Ток посла садржи више корака. [Ингест извори података](data-sources.md), уједините, [...](data-unification.md)[обогатите и](enrichment-hub.md)[извезите](export-destinations.md) податке. Сви ти кораци могу да се покрећу појединачно или да се оркестрира са следећим процесима. 

#### <a name="operation-types"></a>Типови операција

| OperationType     | Групиши                                     |
| ----------------- | ----------------------------------------- |
| Ингестион         | [Извори података](data-sources.md)           |
| Преспремање података   | [Извори података](data-sources.md)           |
| Мапирај               | [Уједначавање података](data-unification.md)   |
| Подударање             | [Уједначавање података](data-unification.md)   |
| Обједини             | [Уједначавање података](data-unification.md)   |
| Историја профила      | [Профили клијената](customer-profiles.md) |
| Претражите            | [Профили клијената](customer-profiles.md) |
| Активност          | [Активности](activities.md)                  |
| АтрибутМеасурес | [Сегменти и мере](segments.md)      |
| ЕнтитетМеасурес    | [Сегменти и мере](segments.md)      |
| Мере          | [Сегменти и мере](segments.md)      |
| Сегментација      | [Сегменти и мере](segments.md)      |
| Обогаћивање        | [Обогаћивање](enrichment-hub.md)                                          |
| Информације      | [Предвиђања](predictions-overview.md)                                          |
| АиБуилдер         | [Предвиђања](predictions-overview.md)                                          |
| Увиди          | [Предвиђања](predictions-overview.md)                                          |
| Export            | [Извоз](export-destinations.md)                                          |
| МоделМанагемент   | [Предвиђања](custom-models.md)                                           |
| Релација      | [Уједначавање података](relationships.md)                                           |

#### <a name="field-description"></a>Опис поља

| Поље           | Типподатака  | Обавезно/опционално | Опис                                                                                                                                                   | Пример                                                                                                                                                                  |
| --------------- | --------- | ----------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| `time`          | Временска ознака | Потребно          | Тиместамп догађаја (УТЦ).                                                                                                                                 | `2020-09-08T09:48:14.8050869Z`                                                                                                                                           |
| `resourceId`    | String    | Потребно          | ИД ресурса инстанце која је емитује догађај.                                                                                                            | `/SUBSCRIPTIONS/XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXX/RESOURCEGROUPS/<RESOURCEGROUPNAME>/`<br>`PROVIDERS/MICROSOFT.D365CUSTOMERINSIGHTS/`<br>`INSTANCES/XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXX` |
| `operationName` | String    | Потребно          | Име операције представљене овим догађајем. `{OperationType}.[WorkFlow|Task][Started|Completed]`. Погледајте [типове операција](#operation-types) за референцу. | `Segmentation.WorkflowStarted`,<br> `Segmentation.TaskStarted`, <br> `Segmentation.TaskCompleted`, <br> `Segmentation.WorkflowCompleted`                                 |
| `category`      | String    | Потребно          | Евидентирај категорију догађаја. Увек `Operational` за догађаје тока посла                                                                                           | `Operational`                                                                                                                                                            | 
| `resultType`    | String    | Потребно          | Статус догађаја. `Running`, `Skipped`, `Successful`, `Failure`                                                                                            |                                                                                                                                                                          |
| `durationMs`    | Дугачак      | Опционално          | Трајање операције у милисекундама.                                                                                                                    | `133`                                                                                                                                                                    |
| `properties`    | String    | Опционално          | ЈСОН објекат са више својстава према одређеној категорији догађаја.                                                                                        | Погледајте подсе одсек ["Својства тока посла"](#workflow-properties-schema)                                                                                                       |
| `level`         | String    | Потребно          | Ниво озбиљности догађаја.                                                                                                                                  | `Informational`, `Warning` или `Error`                                                                                                                                   |
|                 |

#### <a name="workflow-properties-schema"></a>Шема својстава тока посла

Догађаји тока посла имају следећа својства.

| Поље              | Workflow | Задатак | Опис            |
| ------------------------------- | -------- | ---- | ----------- |
| `properties.eventType`                       | Да      | Да  | Увек `WorkflowEvent`, означавање догађаја као догађаја тока посла.                                                                                                                                                                                                |
| `properties.workflowJobId`                   | Да      | Да  | Идентификатор тока посла. Сви догађаји тока посла и задатака у оквиру извршавања тока посла имају исти `workflowJobId`.                                                                                                                                   |
| `properties.operationType`                   | Да      | Да  | Идентификатор операције погледајте [Типови операција]. (#оператион типови података)                                                                                                                                                                                       |
| `properties.tasksCount`                      | Да      | No   | Само ток посла. Број задатака које ток посла покреће.                                                                                                                                                                                                       |
| `properties.submittedBy`                     | Да      | No   | Опционално. Само догађаји тока посла. ИД Azure Active Directory [објекта корисника који је](/azure/marketplace/find-tenant-object-id#find-user-object-id) активирао ток посла, погледајте такође `properties.workflowSubmissionKind`.                                   |
| `properties.workflowType`                    | Да      | No   | `full` или `incremental` освежити.                                                                                                                                                                                                                            |
| `properties.workflowSubmissionKind`          | Да      | No   | `OnDemand` или `Scheduled`.                                                                                                                                                                                                                                  |
| `properties.workflowStatus`                  | Да      | No   | `Running` или `Successful`.                                                                                                                                                                                                                                 |
| `properties.startTimestamp`                  | Да      | Да  | УТЦ Тиместамп`yyyy-MM-ddThh:mm:ss.SSSSSZ`                                                                                                                                                                                                                  |
| `properties.endTimestamp`                    | Да      | Да  | УТЦ Тиместамп`yyyy-MM-ddThh:mm:ss.SSSSSZ`                                                                                                                                                                                                                  |
| `properties.submittedTimestamp`              | Да      | Да  | УТЦ Тиместамп`yyyy-MM-ddThh:mm:ss.SSSSSZ`                                                                                                                                                                                                                  |
| `properties.instanceId`                      | Да      | Да  | Увиди купаца`instanceId`                                                                                                                                                                                                                              |  |
| `properties.identifier`                      | No       | Да  | - За ОператионТyпе = `Export`, идентификатор је гуид конфигурације извоза. <br> - За ОператионТyпе = `Enrichment`, то је гуид богаћења <br> - За ОператионТyпе `Measures` и, идентификатор је име `Segmentation` ентитета. |
| `properties.friendlyName`                    | No       | Да  | Кориснички прилагођено име извоза или ентитета који се обрађује.                                                                                                                                                                                           |
| `properties.error`                           | No       | Да  | Опционално. Порука о грешци са више детаља.                                                                                                                                                                                                                  |
| `properties.additionalInfo.Kind`             | No       | Да  | Опционално. Само за `Export` ОператионТyпе. Идентификује тип извоза. Више информација потражите у [чланку Преглед одредишта извоза](export-destinations.md).                                                                                          |
| `properties.additionalInfo.AffectedEntities` | No       | Да  | Опционално. Само за `Export` ОператионТyпе. Садржи листу конфигурисаних ентитета у извозу.                                                                                                                                                            |
| `properties.additionalInfo.MessageCode`      | No       | Да  | Опционално. Само за `Export` ОператионТyпе. Детаљна порука за извоз.                                                                                                                                                                                 |
| `properties.additionalInfo.entityCount`      | No       | Да  | Опционално. Само за `Segmentation` ОператионТyпе. Означава укупан број чланова које сегмент има.                                                                                                                                                    |
